import ClockSvg from '@/assets/svgs/clock.svg';
import DishSvg from '@/assets/svgs/dish.svg';
import PulseSvg from '@/assets/svgs/pulse.svg';
import StarSvg from '@/assets/svgs/star.svg';
import { roundDuration } from '@/lib/helpers/roundDuration';
import { shortenDescription } from '@/lib/helpers/shortenDescription';
import { cn } from '@/lib/utils';
import { Link } from '@inertiajs/react';
import LazyImage from './lazy-image';

const MAX_WORDS = 12;

type SharedCardProps = {
    href: string;
    name: string;
    img: string | undefined;
    alt: string | undefined;
    tinyImg: string | undefined;
    description: string;
    duration: number | undefined;
    rating: number | undefined;
    category: string | undefined;
};

type ContentCardProps = {
    type: string;
    data: SharedCardProps;
    className?: string;
};

export default function ContentCard({
    type,
    data,
    className,
}: ContentCardProps) {
    const {
        href,
        name,
        img,
        tinyImg,
        alt,
        description,
        duration,
        rating,
        category,
    } = data;
    const roundedDuration = roundDuration(duration ?? 0);
    const shortenedDescription = shortenDescription(description, MAX_WORDS);

    const categoryIcon = type === 'recipe' ? DishSvg : PulseSvg;
    const durationLabel =
        type === 'exercise' ? 'Время упражнения' : 'Время приготовления';
    const labelPrefix = type === 'exercise' ? 'Упражнение' : 'Рецепт';

    return (
        <li
            className={cn(
                'transition-scale min-h-130 w-80 cursor-pointer list-none rounded-[3rem] border-2 border-white/20 bg-card-backdrop-gray/50 p-6.5 text-white backdrop-blur-sm duration-200 ease-in hover:scale-105',
                className,
            )}
            role="article"
            aria-label={`${labelPrefix}: ${name}`}
        >
            <Link
                prefetch
                href={href}
            >
                {img && alt && tinyImg && (
                    <LazyImage
                        parentClass="overflow-clip rounded-[2rem] mb-5 h-57"
                        img={img}
                        alt={alt}
                        tinyImg={tinyImg}
                    />
                )}

                <div className="-mx-2 flex min-h-54 flex-col justify-between gap-2 px-2.5">
                    <h3 className="-mx-2 mb-2.5 text-center text-xl leading-7 text-balance text-white">
                        {name}
                    </h3>

                    <p className="mb-2 flex-1 h-full text-balance">{shortenedDescription}</p>

                    <div className="mt-auto flex border border-red-400 items-center justify-between">
                        {duration && (
                            <div
                                className="flex items-center gap-1"
                                aria-label={`${durationLabel}: ${duration} минут`}
                            >
                                <img
                                    src={ClockSvg}
                                    alt=""
                                    className="size-4.5"
                                    aria-hidden="true"
                                />
                                <span className="text-sm">
                                    {roundedDuration}
                                </span>
                            </div>
                        )}

                        {rating && <div
                            className="flex items-center gap-1"
                            aria-label={`Оценка: ${rating} из 10`}
                        >
                            <img
                                src={StarSvg}
                                alt=""
                                className="size-4.5"
                                aria-hidden="true"
                            />
                            <span className="text-sm">{`${rating}/10`}</span>
                        </div>}

                        {category && <div
                            className="flex items-center gap-1"
                            aria-label={`Категория: ${category}`}
                        >
                            <img
                                src={categoryIcon}
                                alt=""
                                className="size-4.5"
                                aria-hidden="true"
                            />
                            {category && (
                                <span className="text-sm">{category}</span>
                            )}
                        </div>}
                    </div>
                </div>
            </Link>
        </li>
    );
}
